// BP 7.1.6 content: ModelClass syschar: 3 persistence-version: 7.1.6

within lichess_bot::components::Engine::board is

  //! One of the chessmen
  @key_letters("Piece");
  @class_num(2);
  class Piece is

    //! Create and place the pieces on the board.
    @dialect("oal");
    @operation_num(1);
    class operation initialize() is
      @noparse
      // Create and place white pieces
      select any player from instances of Player
       where ( selected.Color == Color::WHITE);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Rook");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "h1");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Knight");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "g1");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Bishop");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "f1");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "King");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "e1");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Queen");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "d1");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Bishop");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "c1");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Knight");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "b1");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Rook");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "a1");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Pawn");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "h2");
      sq.occupy(piece:p);
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "g2");
      sq.occupy(piece:p);
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "f2");
      sq.occupy(piece:p);
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "e2");
      sq.occupy(piece:p);
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "d2");
      sq.occupy(piece:p);
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "c2");
      sq.occupy(piece:p);
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "b2");
      sq.occupy(piece:p);
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "a2");
      sq.occupy(piece:p);

      // Create and place black pieces
      select any player from instances of Player
       where ( selected.Color == Color::BLACK);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Rook");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "h8");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Knight");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "g8");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Bishop");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "f8");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "King");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "e8");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Queen");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "d8");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Bishop");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "c8");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Knight");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "b8");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Rook");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "a8");
      sq.occupy(piece:p);

      select any spec from instances of PieceSpecification
       where ( selected.Name == "Pawn");
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "h7");
      sq.occupy(piece:p);
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "g7");
      sq.occupy(piece:p);
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "f7");
      sq.occupy(piece:p);
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "e7");
      sq.occupy(piece:p);
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "d7");
      sq.occupy(piece:p);
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "c7");
      sq.occupy(piece:p);
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "b7");
      sq.occupy(piece:p);
      create object instance p of Piece;
      relate p to spec across R4.'is specified by';
      relate p to player across R7.'belongs to';
      select any sq from instances of Square
       where (selected.lichess_desig == "a7");
      sq.occupy(piece:p);
      @endnoparse
    end operation;

    @dialect("oal");
    @operation_num(2);
    operation clean_moves() is
      @noparse
      // Dispose of all moves associated with this piece
      select many moves related by self->Move[R9.'can make'];
      for each move in moves
        //LOG::LogInfo( message:"Cleaning Move: " + move.Notation );
        move.dispose();
      end for;
      @endnoparse
    end operation;

  end class;

end;
